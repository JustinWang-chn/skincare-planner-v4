<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>护肤指南</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <!-- 让它在 iPhone 上更像独立 App -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="apple-mobile-web-app-title" content="护肤指南" />

    <!-- Tailwind：负责样式 -->
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-zinc-50">
    <div id="root"></div>

    <!-- React 运行环境 -->
    <script
      src="https://unpkg.com/react@18/umd/react.production.min.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
      crossorigin
    ></script>
    <!-- Babel：让浏览器直接跑 JSX 代码 -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 你的 App 代码 -->
     <script type="text/babel">
      const { useState, useEffect } = React;

      const DAY_LABELS = ["一", "二", "三", "四", "五", "六", "日"];
      const STORAGE_KEY = "skincare_planner_v3";

      // 两套主题：明月珰/石榴裙、栀子/绛蝶
      const THEMES = {
        mingyue: {
          key: "mingyue",
          label: "明月珰",
          subLabel: "石榴裙",
          bg: "#D6D4CD", // 明月珰
          text: "#4A2F2A",
          accent: "#B3392F", // 石榴裙
          accentTextOn: "#FFF9F5",
          border: "#CFC3B9",
          chipBg: "#F3EDE6",
        },
        zhizi: {
          key: "zhizi",
          label: "栀子",
          subLabel: "绛蝶",
          bg: "#2D2E3D", // 绛蝶 深色
          text: "#F8F7F3",
          accent: "#FEC13F", // 栀子
          accentTextOn: "#2D2E3D",
          border: "#394154",
          chipBg: "#394154",
        },
      };

      const uid = () => Math.random().toString(36).slice(2, 9);

      function makeSteps(names) {
        return names.map((n) => ({ id: uid(), name: n }));
      }

      function defaultWeekPlan() {
        const week = {};

        // 周一（Stridex 日）
        week[0] = {
          steps: makeSteps([
            "洗脸",
            "Stridex 棉片擦鼻子 + 下巴 + 下颌（1–2 遍）",
            "等 10 分钟",
            "B5 全脸",
          ]),
        };

        // 周二（阿达帕林日）
        week[1] = {
          steps: makeSteps([
            "洗脸 → 等脸干 → 少量酵母水",
            "阿达帕林豌豆大小，薄涂下巴/下颌（可带 T 区）",
            "3–5 分钟后 B5 全脸",
          ]),
        };

        // 周三（VC 日）
        week[2] = {
          steps: makeSteps([
            "洗脸 → 酵母水",
            "乐敦 VC 点涂痘印",
            "B5 全脸（两颊干可叠一点羊油）",
          ]),
        };

        // 周四（Stridex 日，同周一）
        week[3] = {
          steps: makeSteps([
            "洗脸",
            "Stridex 棉片擦 T 区 + 下巴",
            "等 10 分钟",
            "B5 全脸",
          ]),
        };

        // 周五（阿达帕林日，同周二）
        week[4] = {
          steps: makeSteps([
            "洗脸 → 酵母水",
            "阿达帕林豌豆大小，薄涂下巴/下颌（可带 T 区）",
            "3–5 分钟后 B5 全脸",
          ]),
        };

        // 周六（泥膜大清洁）
        week[5] = {
          steps: makeSteps([
            "洗脸",
            "泥膜敷 T 区 + 下巴 5–10 分钟 → 洗掉",
            "酵母水",
            "B5 全脸",
            "当天不再用 Stridex / 微酸水 / 阿达帕林 / VC",
          ]),
        };

        // 周日（VC 日）
        week[6] = {
          steps: makeSteps([
            "洗脸 → 酵母水",
            "乐敦 VC 点涂痘印",
            "B5 全脸（干区可叠少量羊油）",
          ]),
        };

        return week;
      }

      function useLocalStorageState(key, init) {
        const [state, setState] = useState(() => {
          try {
            const raw = window.localStorage.getItem(key);
            return raw ? JSON.parse(raw) : init();
          } catch (e) {
            return init();
          }
        });

        useEffect(() => {
          try {
            window.localStorage.setItem(key, JSON.stringify(state));
          } catch (e) {}
        }, [key, state]);

        return [state, setState];
      }

      function StepRow({ step, index, onDelete, onChange, theme }) {
        const cardStyle = { borderColor: theme.border };
        const badgeStyle = {
          backgroundColor: theme.accent,
          color: theme.accentTextOn,
        };
        const inputStyle = { borderColor: theme.border };
        const deleteStyle = {
          borderColor: theme.border,
          backgroundColor: theme.chipBg,
          color: theme.text,
        };

        return (
          <div
            className="flex items-start gap-3 rounded-2xl border p-3 bg-white"
            style={cardStyle}
          >
            <div
              className="mt-1 h-6 w-6 shrink-0 rounded-full text-center text-sm font-medium leading-6"
              style={badgeStyle}
            >
              {index + 1}
            </div>
            <div className="flex-1">
              <input
                className="w-full rounded-lg bg-white px-3 py-2 text-sm outline-none focus:ring-2"
                style={inputStyle}
                value={step.name}
                onChange={(e) =>
                  onChange({ ...step, name: e.target.value })
                }
              />
            </div>
            <button
              onClick={onDelete}
              className="rounded-xl border px-3 py-2 text-xs hover:opacity-90"
              style={deleteStyle}
            >
              删除
            </button>
          </div>
        );
      }

      function SkincarePlannerSimple() {
        const [week, setWeek] = useLocalStorageState(
          STORAGE_KEY,
          defaultWeekPlan
        );
        const [day, setDay] = useState((new Date().getDay() + 6) % 7); // 周一为 0
        const [themeKey, setThemeKey] = useState("mingyue");
        const theme = THEMES[themeKey];

        const focusPlan = week[String(day)] || { steps: [] };

        function setFocusPlan(plan) {
          setWeek((prev) => ({
            ...prev,
            [String(day)]: plan,
          }));
        }

        function addStep() {
          setFocusPlan({
            ...focusPlan,
            steps: [...focusPlan.steps, { id: uid(), name: "新步骤" }],
          });
        }

        function resetAll() {
          if (window.confirm("确定恢复为默认护肤流程？")) {
            setWeek(defaultWeekPlan());
          }
        }

        const rootStyle = {
          backgroundColor: theme.bg,
          color: theme.text,
        };

        const headerStyle = {
          background: `linear-gradient(to bottom, ${theme.bg}, transparent)`,
        };

        return (
          <div className="mx-auto max-w-md min-h-screen p-4" style={rootStyle}>
            {/* 顶部 */}
            <div
              className="sticky top-0 z-10 mb-4 flex items-center justify-between py-2"
              style={headerStyle}
            >
              <div className="text-2xl font-bold tracking-wide">护肤指南</div>
              <div className="flex gap-2 text-xs">
                <button
                  onClick={() => setThemeKey("mingyue")}
                  className="rounded-full border px-2 py-1"
                  style={
                    themeKey === "mingyue"
                      ? {
                          backgroundColor: THEMES.mingyue.accent,
                          borderColor: THEMES.mingyue.accent,
                          color: THEMES.mingyue.accentTextOn,
                          boxShadow: "0 3px 8px rgba(0,0,0,0.18)",
                        }
                      : {
                          borderColor: THEMES.mingyue.accent,
                          color: THEMES.mingyue.accent,
                          backgroundColor: "rgba(255,255,255,0.8)",
                        }
                  }
                >
                  明月珰
                </button>
                <button
                  onClick={() => setThemeKey("zhizi")}
                  className="rounded-full border px-2 py-1"
                  style={
                    themeKey === "zhizi"
                      ? {
                          backgroundColor: THEMES.zhizi.accent,
                          borderColor: THEMES.zhizi.accent,
                          color: THEMES.zhizi.accentTextOn,
                          boxShadow: "0 3px 8px rgba(0,0,0,0.18)",
                        }
                      : {
                          borderColor: THEMES.zhizi.accent,
                          color: THEMES.zhizi.accent,
                          backgroundColor: "rgba(255,255,255,0.8)",
                        }
                  }
                >
                  栀子
                </button>
              </div>
            </div>

            {/* 星期选择 */}
            <section className="mb-5">
              <div className="mb-2 text-sm" style={{ opacity: 0.8 }}>
                选择星期
              </div>
              <div className="grid grid-cols-7 gap-2">
                {DAY_LABELS.map((l, idx) => {
                  const active = day === idx;
                  const baseStyle = active
                    ? {
                        backgroundColor: theme.accent,
                        borderColor: theme.accent,
                        color: theme.accentTextOn,
                        boxShadow: "0 4px 10px rgba(0,0,0,0.18)",
                      }
                    : {
                        backgroundColor: theme.chipBg,
                        borderColor: theme.border,
                        color: theme.text,
                      };
                  return (
                    <button
                      key={l}
                      onClick={() => setDay(idx)}
                      className="h-11 rounded-2xl border text-base font-medium transition"
                      style={baseStyle}
                    >
                      {l}
                    </button>
                  );
                })}
              </div>
            </section>

            {/* 护肤步骤 */}
            <section className="pb-6">
              <div className="mb-2 flex items-center justify-between">
                <div className="text-base font-semibold">每日护肤步骤</div>
                <div className="flex gap-2">
                  <button
                    onClick={addStep}
                    className="rounded-xl border px-3 py-2 text-sm shadow-sm"
                    style={{
                      backgroundColor: theme.accent,
                      borderColor: theme.accent,
                      color: theme.accentTextOn,
                    }}
                  >
                    新增步骤
                  </button>
                  <button
                    onClick={resetAll}
                    className="rounded-xl border px-3 py-2 text-sm"
                    style={{
                      backgroundColor: theme.chipBg,
                      borderColor: theme.border,
                      color: theme.text,
                    }}
                  >
                    重置模板
                  </button>
                </div>
              </div>
              <div className="grid gap-3">
                {focusPlan.steps.map((s, i) => (
                  <StepRow
                    key={s.id}
                    step={s}
                    index={i}
                    theme={theme}
                    onDelete={() =>
                      setFocusPlan({
                        ...focusPlan,
                        steps: focusPlan.steps.filter(
                          (x) => x.id !== s.id
                        ),
                      })
                    }
                    onChange={(ns) =>
                      setFocusPlan({
                        ...focusPlan,
                        steps: focusPlan.steps.map((x) =>
                          x.id === ns.id ? ns : x
                        ),
                      })
                    }
                  />
                ))}
              </div>
            </section>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<SkincarePlannerSimple />);
    </script>


    <!-- 注册 Service Worker，用于离线缓存 -->
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", function () {
          navigator.serviceWorker
            .register("./sw.js")
            .catch(function (err) {
              console.log("Service worker registration failed:", err);
            });
        });
      }
    </script>
  </body>
</html>
